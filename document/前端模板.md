# 前端模板
前端模板引擎有很多，大部分都是大同小异，我们经常看到通过字符串来拼接很长的一端html代码，里面有html代码，有js代码。这样完全将html和js代码耦合在一起。
### 前端模板引擎原理：
通过前端模板函数将模板中的html代码和js语句、变量分离，然后通过Function构造函数来动态生成具有数据性的html代码。
### 具体代码实现：
```
function template (tpl , data) {
	var result = 'var arr = [];';
    var splitSymbol = '|';
	var str = tpl
                .replace(/<%?=(\s*.+)%>/g , 'arr.push($1)' + splitSymbol)
                .replace(/<%(\s*.+)%>/g , '$1' + splitSymbol)
                .replace(/(<[^<\/|%>]+>)/g , 'arr.push("$1")' + splitSymbol)
                .replace(/(<\/.+>)/g , 'arr.push("$1")' + splitSymbol)
	result = result + str;
	result  += 'return arr.join("")';
	result = result.split('|');
	result = result.map(function (item) {
		return item.trim();
	});
    return new Function('data' , result.join('\n'))(data);
};
```
### 例子：

```
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
<div id="box"></div>
<script type="text/html" id="tpl">
	<% if (data.show) { %>
		<span><%= data.name %></span>
	<% } else { %>
		<span><%= data.age %></span>
    <% } %>
    <% for (var i = 0 ; i < data.list.length ; i++) { %>
        <% if (data.list[i] >= 2) { %>
            <span><%= data.list[i] %></span>
        <% } else { %>
            <span style='color:#f00;'><%= data.list[i] %></span>
        <% } %>
    <% } %>
</script>
<script>
var str = document.getElementById('tpl').innerHTML;
var obj = {
	show : false,
	name : 'andy',
	age : 22,
    list : [1,2,3,4]
};
function template (tpl , data) {
	var result = 'var arr = [];';
    var splitSymbol = '|';
	var str = tpl
                .replace(/<%?=(\s*.+)%>/g , 'arr.push($1)' + splitSymbol)
                .replace(/<%(\s*.+)%>/g , '$1' + splitSymbol)
                .replace(/(<[^<\/|%>]+>)/g , 'arr.push("$1")' + splitSymbol)
                .replace(/(<\/.+>)/g , 'arr.push("$1")' + splitSymbol)
	result = result + str;
	result  += 'return arr.join("")';
	result = result.split('|');
	result = result.map(function (item) {
		return item.trim();
	});
    return new Function('data' , result.join('\n'))(data);
};
var s = template(str , obj);
var box = document.getElementById('box');
box.innerHTML = s;
</script>
</body>
</html>
```